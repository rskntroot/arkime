version: '3'

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.10.1
    hostname: elasticsearch
    environment:
      - discovery.type=single-node

  viewer:
    build:
      context: .
    image: rskntroot/arkime:2.7.1-1
    hostname: viewer
    environment:
      - ARKIME_USER=root
      - ARKIME_PSWD=arkime-pswd
    depends_on:
      - elasticsearch
    volumes:
      - ./log:/arkime/log
    entrypoint: /arkime/bin/viewer.sh

  import:
    image: rskntroot/arkime:2.7.1-1
    hostname: import
    depends_on:
      - elasticsearch
      - viewer
    environment:
      - ARKIME_USER=root
      - ARKIME_PSWD=arkime-pswd
    volumes:
      - ./log:/arkime/log
      - ./import:/import
    entrypoint: /arkime/bin/import.sh

  nginx:
    image: nginx:mainline-alpine
    hostname: nginx
    volumes:
      - ./etc:/etc/nginx/conf.d:ro
      - ./ssl:/ssl:ro
      - ./log:/var/log/nginx:rw
    depends_on:
      - viewer
    ports:
      - 80:80
